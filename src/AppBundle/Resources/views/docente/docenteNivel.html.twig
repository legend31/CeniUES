{% extends "::layoutbase.html.twig" %}

{% block title %} Asignar niveles {% endblock %}

{% block principal %}
    <head>
        <script src="{{ asset("libs/AdminLTE-2.2.0/plugins/jQuery/jQuery-2.1.4.min.js") }}" type="text/javascript"></script>
    </head>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-danger">
                    <div class="box-header">
                        <h3 class="box-title">Asignar docentes en niveles</h3>
                        <div class="box-tools">
                            <div class="input-group" style="width: 350px;">
                                <input type="text" name="table_search" class="form-control input-sm pull-right" placeholder="Buscar">
                                <div class="input-group-btn">
                                    <button class="btn btn-sm btn-default"><i class="fa fa-search"></i></button>
                                </div>
                            </div>
                        </div>

                        <!--Impresion de errores-->
                        <!--Docente no existen-->
                        {% if error == 1 %}
                            <div class="alert alert-danger alert-dismissable">
                                <h4><i class="icon fa fa-ban"></i> Docentes no existen</h4>
                                <b>Error</b> no existe ning&uacute;n docente dentro del sistema.
                            </div>

                        <!--locales no definidos-->
                        {% elseif error == 2 %}
                            <div class="alert alert-danger alert-dismissable">
                                <h4><i class="icon fa fa-ban"></i> Locales no definidos</h4>
                                <b>Error</b> debe definir locales para poder asignar donde se impartiran las clases.
                            </div>

                        <!--niveles no creados-->
                        {% elseif error == 3 %}
                            <div class="alert alert-danger alert-dismissable">
                                <h4><i class="icon fa fa-ban"></i> Niveles no definidos</h4>
                                <b>Error</b> debe definir niveles.
                            </div>

                        <!--secciones no definidas-->
                        {% elseif error == 4 %}
                            <div class="alert alert-danger alert-dismissable">
                                <h4><i class="icon fa fa-ban"></i> Secciones no definidos</h4>
                                <b>Error</b> no se pueden definir docentes si no existen secciones para clases.
                            </div>

                        <!--clases-->
                        {% elseif error == 5 %}
                            <div class="alert alert-danger alert-dismissable">
                                <h4><i class="icon fa fa-ban"></i> Clases no definidos</h4>
                                <b>Error</b> no se han encontrado grupos de clases en el sistema.
                            </div>

                        {% endif %}
                        <!--Fin impresion de errores-->

                    </div><!-- /.box-header -->
                    <div class="box-body table-responsive no-padding">
                        <table class="table table-hover">
                            <tbody>
                            <tr>
                                <th>Docente</th>
                                <th>Nivel Asignado</th>
                                <th>Seccion</th>
                                <th>Local</th>
                                <th>Hora Clase</th>
                            </tr>
                            {% for clase in clases %}
                                {% if clase.docenteCarnetdocente %}
                                    <tr>
                                        <td>{{ clase.docenteCarnetdocente.nombredocente }}</td>
                                        <td>
                                            <select class="col-sm-7" id="" name="" disabled>
                                                    <option value="">{{ clase.nivelnivel.nombrenivel }}</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select class="col-sm-7" id="" name="" disabled>
                                                <option value="">Seccion {{ clase.seccion.nombreseccion }}</option>
                                            </select>
                                        </td>
                                        <td>{{ clase.locallocal.nombrelocal }}</td>
                                        <td>{{ clase.horario.format('h:i A') }}</td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                            {% for entity in form %}
                                    <tr>
                                        <td>{{ entity }}</td>
                                        <td>
                                            <select class="col-sm-7" id="niv" name="niv">
                                                {% for nivel in niveles %}
                                                    <option value="{{ nivel.idnivel }}">{{ nivel.nombrenivel }}</option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                        <td>
                                            <select class="col-sm-7" id="sec" name="sec">
                                                <!--<option value="null" selected>Selecionar</option>
                                                {% for seccion in seciones %}
                                                    <option value="{{ seccion.idseccion }}">{{ seccion.nombreseccion }}</option>
                                                {% endfor %}-->
                                            </select>
                                        </td>
                                        <td id="local"></td>
                                        <td></td>
                                    </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div><!-- /.box-body -->
                </div><!-- /.box -->
            </div>
        </div>
    </section>

    <script>
        $('document').ready(function(){
            $("#niv").change(function(){
                var niv = $(this).val();

                if(niv>0){

                    var datos ={
                        idniv : $(this).val()
                    };

                    $.post("{{ path('js2') }}", datos, function(response){

                        var $combosec = $('#sec');
                        var $loca = $('#local');

                        $combosec.empty();

                        $.each(response,function(i, val){
                            $combosec.append("<option>"+ "Seccion " + val +"</option>");
                        });
                    },'json');
                }else{
                    //limpiamos combo y pedimos que seleccione un nivel
                    var $combosec = $('#sec');
                    $combosec.empty();
                    $combosec.val("Seleccione un nivel");
                }
            });
        });
    </script>
{% endblock %}
